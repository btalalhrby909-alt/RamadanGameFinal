<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¬Ù„Ø³ Ø£Ø®Ø± Ø­Ø±Ù ğŸŒ™</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --gold: #d4af37;
            --gold-light: #f9e29b;
            --deep-blue: #0a0e17;
            --accent: #1e293b;
        }

        body {
            background: var(--deep-blue) url('https://www.transparenttextures.com/patterns/dark-matter.png');
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ÙØ®Ù…Ø© */
        .glass-panel {
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid var(--gold);
            border-radius: 30px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
            text-align: center;
        }

        .timer-circle {
            font-size: 5rem;
            font-weight: 900;
            color: var(--gold-light);
            text-shadow: 0 0 15px var(--gold);
            margin: 20px 0;
        }

        .player-card {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 15px;
            background: var(--accent);
            border: 1px solid #334155;
            transition: 0.3s;
        }

        .active-turn {
            border-color: var(--gold);
            box-shadow: 0 0 10px var(--gold);
            background: #064e3b;
        }

        .is-out { opacity: 0.3; text-decoration: line-through; }

        input {
            width: 80%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            background: #000;
            color: #fff;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 20px;
        }

        .btn-gold {
            background: linear-gradient(45deg, var(--gold), var(--gold-light));
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            width: 85%;
        }

        #wordLog {
            height: 60px;
            overflow-x: auto;
            white-space: nowrap;
            margin: 20px 0;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            color: var(--gold-light);
        }
    </style>
</head>
<body>

<div class="glass-panel" id="lobby">
    <h1 style="color: var(--gold)">Ù…Ø¬Ù„Ø³ Ø±Ù…Ø¶Ø§Ù† ğŸŒ™</h1>
    <input type="text" id="nameInp" placeholder="Ø§Ø³Ù…Ùƒ">
    <input type="text" id="roomInp" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
    <button class="btn-gold" onclick="join()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</button>
</div>

<div class="glass-panel" id="game" style="display:none;">
    <div id="pointsDisplay" style="color: var(--gold); margin-bottom: 10px;"></div>
    <div id="playersList"></div>
    
    <div class="timer-circle" id="timer">20</div>
    
    <div style="font-size: 1.5rem;">
        Ø§Ù„ÙØ¦Ø©: <span id="cat" style="color:var(--gold)">-</span> | 
        Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <span id="char" style="color:var(--gold)">-</span>
    </div>

    <div id="wordLog"></div>

    <input type="text" id="wordInp" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©...">
    <button class="btn-gold" onclick="submit()">Ø¥Ø±Ø³Ø§Ù„ âœ…</button>
    <button class="btn-gold" id="startBtn" onclick="socket.emit('startGame')" style="display:none; background: #064e3b; color: white;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© ğŸš€</button>
</div>

<script>
    const socket = io();
    let myName = "";

    function join() {
        myName = document.getElementById('nameInp').value;
        const room = document.getElementById('roomInp').value;
        if(myName && room) {
            socket.emit('joinRoom', room, myName);
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game').style.display = 'block';
        }
    }

    function submit() {
        const inp = document.getElementById('wordInp');
        socket.emit('submitWord', inp.value);
        inp.value = "";
    }

    socket.on('updateGameState', (data) => {
        const cats = ["Ø£Ø³Ù…Ø§Ø¡", "Ø­ÙŠÙˆØ§Ù†", "Ø¬Ù…Ø§Ø¯", "Ø¨Ù„Ø§Ø¯"];
        document.getElementById('cat').innerText = cats[data.curCatIdx];
        document.getElementById('char').innerText = data.reqChar || "Ø£ÙŠ Ø­Ø±Ù";
        document.getElementById('wordLog').innerText = data.usedWords.join(" â† ");

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ù†Ù‚Ø§Ø·
        let pList = "";
        let sList = "";
        data.players.forEach((p, i) => {
            const active = (i === data.curIdx) ? 'active-turn' : '';
            const out = p.isOut ? 'is-out' : '';
            pList += `<div class="player-card ${active} ${out}">${p.name}</div>`;
            sList += `${p.name}: ${p.points}Ù† | `;
        });
        document.getElementById('playersList').innerHTML = pList;
        document.getElementById('pointsDisplay').innerText = sList;

        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©
        if(!data.timer && data.players[0].name === myName) {
            document.getElementById('startBtn').style.display = 'block';
        } else {
            document.getElementById('startBtn').style.display = 'none';
        }
    });

    socket.on('timerUpdate', (t) => {
        document.getElementById('timer').innerText = t;
    });

    socket.on('gameResult', (msg) => {
        alert(msg);
        location.reload();
    });

    socket.on('errorMsg', (m) => alert(m));
    socket.on('newChatMsg', (d) => console.log(d.text));
</script>
</body>
</html>