<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¬Ù„Ø³ Ø£Ø®Ø± Ø­Ø±Ù ğŸŒ™</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>.game-layout { display: grid; grid-template-columns: 1fr 300px; gap: 20px; width: 95%; max-width: 1000px; }
        .chat-box { background: rgba(0,0,0,0.5); border-radius: 15px; display: flex; flex-direction: column; height: 500px; border: 1px solid var(--gold); }
        #chatMsgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 14px; }
        #wordHistory { background: rgba(251, 191, 36, 0.1); padding: 10px; border-radius: 10px; height: 100px; overflow-y: auto; margin: 10px 0; border: 1px solid var(--gold); }
        .timer-active { color: #ef4444; animation: blink 1s infinite; } 
    </style>
</head>
<body>

<div class="glass-panel" id="lobby">
    <h1 style="color: var(--gold)">Ù…Ø¬Ù„Ø³ Ø±Ù…Ø¶Ø§Ù† ğŸŒ™</h1>
    <input type="text" id="nameInp" placeholder="Ø§Ø³Ù…Ùƒ">
    <input type="text" id="roomInp" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
    <button class="btn-gold" onclick="join()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</button>
</div>

<div class="glass-panel" id="game" style="display:none;">
    <div id="pointsDisplay" style="color: var(--gold); margin-bottom: 10px;"></div>
    <div id="playersList"></div>
    
    <div class="timer-circle" id="timer">20</div>
    
    <div style="font-size: 1.5rem;">
        Ø§Ù„ÙØ¦Ø©: <span id="cat" style="color:var(--gold)">-</span> | 
        Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <span id="char" style="color:var(--gold)">-</span>
    </div>

    <div id="wordLog"></div>

    <input type="text" id="wordInp" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©...">
    <button class="btn-gold" onclick="submit()">Ø¥Ø±Ø³Ø§Ù„ âœ…</button>
    <button class="btn-gold" id="startBtn" onclick="socket.emit('startGame')" style="display:none; background: #064e3b; color: white;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© ğŸš€</button>
</div>

<script>
    const socket = io();
    let myName = "";

    function join() {
        myName = document.getElementById('nameInp').value;
        const room = document.getElementById('roomInp').value;
        if(myName && room) {
            socket.emit('joinRoom', room, myName);
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game').style.display = 'block';
        }
    }

    function submit() {
        const inp = document.getElementById('wordInp');
        socket.emit('submitWord', inp.value);
        inp.value = "";
    }

    socket.on('updateGameState', (data) => {
        const cats = ["Ø£Ø³Ù…Ø§Ø¡", "Ø­ÙŠÙˆØ§Ù†", "Ø¬Ù…Ø§Ø¯", "Ø¨Ù„Ø§Ø¯"];
        document.getElementById('cat').innerText = cats[data.curCatIdx];
        document.getElementById('char').innerText = data.reqChar || "Ø£ÙŠ Ø­Ø±Ù";
        document.getElementById('wordLog').innerText = data.usedWords.join(" â† ");

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ù†Ù‚Ø§Ø·
        let pList = "";
        let sList = "";
        data.players.forEach((p, i) => {
            const active = (i === data.curIdx) ? 'active-turn' : '';
            const out = p.isOut ? 'is-out' : '';
            pList += `<div class="player-card ${active} ${out}">${p.name}</div>`;
            sList += `${p.name}: ${p.points}Ù† | `;
        });
        document.getElementById('playersList').innerHTML = pList;
        document.getElementById('pointsDisplay').innerText = sList;

        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©
        if(!data.timer && data.players[0].name === myName) {
            document.getElementById('startBtn').style.display = 'block';
        } else {
            document.getElementById('startBtn').style.display = 'none';
        }
    });

    socket.on('timerUpdate', (t) => {
        document.getElementById('timer').innerText = t;
    });

    socket.on('gameResult', (msg) => {
        alert(msg);
        location.reload();
    });

    socket.on('errorMsg', (m) => alert(m));
    socket.on('newChatMsg', (d) => console.log(d.text));
</script>
</body>
</html>