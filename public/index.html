<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø£Ø®Ø± Ø­Ø±Ù - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ğŸŒ™</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* (Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø³ØªØ§ÙŠÙ„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª) */
        .game-layout { display: grid; grid-template-columns: 1fr 300px; gap: 20px; width: 95%; max-width: 1000px; }
        .chat-box { background: rgba(0,0,0,0.5); border-radius: 15px; display: flex; flex-direction: column; height: 500px; border: 1px solid var(--gold); }
        #chatMsgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 14px; }
        #wordHistory { background: rgba(251, 191, 36, 0.1); padding: 10px; border-radius: 10px; height: 100px; overflow-y: auto; margin: 10px 0; border: 1px solid var(--gold); }
        .timer-active { color: #ef4444; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="setup-screen" class="active-screen">
    <input type="text" id="nameInput" placeholder="Ø§Ø³Ù…Ùƒ">
    <input type="text" id="roomInput" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
    <button class="btn-main" onclick="connect()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="game-layout" id="game-screen" style="display:none;">
    <div class="game-wrapper">
        <div id="timerDisplay" class="timer-val">20</div>
        <h3>Ø§Ù„ÙØ¦Ø©: <span id="catDisplay" style="color:var(--gold)">-</span> | Ø§Ù„Ø­Ø±Ù: <span id="charDisplay" style="color:var(--gold)">-</span></h3>
        
        <div id="wordHistory"><b>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</b><br><span id="usedWordsList"></span></div>
        
        <input type="text" id="wordInput" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©...">
        <button class="btn-main" onclick="sendWord()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©</button>
    </div>

    <div class="chat-box">
        <h4 style="margin:10px; color:var(--gold)">Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h4>
        <div id="chatMsgs"></div>
        <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." style="font-size:14px;">
        <button onclick="sendChat()" style="background:var(--gold); border:none; padding:5px;">Ø§Ø±Ø³Ù„</button>
    </div>
</div>

<script>
    const socket = io();
    let myName = "";

    function connect() {
        myName = document.getElementById('nameInput').value;
        const room = document.getElementById('roomInput').value;
        if(myName && room) {
            socket.emit('joinRoom', room, myName);
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'grid';
        }
    }

    function sendWord() {
        const inp = document.getElementById('wordInput');
        socket.emit('submitWord', inp.value);
        inp.value = "";
    }

    function sendChat() {
        const inp = document.getElementById('chatInput');
        socket.emit('sendChat', inp.value);
        inp.value = "";
    }

    socket.on('timerUpdate', (time) => {
        const t = document.getElementById('timerDisplay');
        t.innerText = time;
        if(time <= 5) t.classList.add('timer-active');
        else t.classList.remove('timer-active');
    });

    socket.on('updateGameState', (data) => {
        document.getElementById('catDisplay').innerText = ["Ø£Ø³Ù…Ø§Ø¡", "Ø­ÙŠÙˆØ§Ù†", "Ø¬Ù…Ø§Ø¯", "Ø¨Ù„Ø§Ø¯"][data.curCatIdx];
        document.getElementById('charDisplay').innerText = data.reqChar || "Ø£ÙŠ Ø­Ø±Ù";
        document.getElementById('usedWordsList').innerText = data.usedWords.join(" â† ");
    });

    socket.on('newChatMsg', (data) => {
        const div = document.getElementById('chatMsgs');
        div.innerHTML += `<div><b>${data.name}:</b> ${data.text}</div>`;
        div.scrollTop = div.scrollHeight;
    });

    socket.on('errorMsg', (msg) => alert(msg));
</script>
</body>
</html>